{% load static %}
{% load widget_tweaks %}
<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset='utf-8'>
        <meta http-equiv = 'X-UA-Compatible' content = 'IE=edge'>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta http-equiv='content-type' content='text/html; charset = utf-8'/>
        <meta name = 'robots' content = 'index, follow'>

        <link rel="apple-touch-icon" sizes="180x180" href="{% static 'favicon_io/apple-touch-icon.png' %}">
        <link rel="icon" sizes="192x192" href="{% static 'favicon_io/android-chrome-192x192.png' %}">
        <link rel="icon" sizes="256x256" href="{% static 'favicon_io/android-chrome-512x512.png' %}">
        <link rel="icon" type="image/x-icon" href="{% static 'favicon_io/favicon.ico' %}">
        <link rel="icon" type="image/png" sizes="32x32" href="{% static 'favicon_io/favicon-32x32.png' %}">
        <link rel="icon" type="image/png" sizes="16x16" href="{% static 'favicon_io/favicon-16x16.png' %}">
        <link rel="manifest" href="{% static 'favicon_io/site.webmanifest' %}">

        <link rel = 'stylesheet' href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css'>
        <link rel = 'stylesheet' href='https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css'>
        <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">


        <!-- Tailwind Animation -->
        <style>
            @keyframes fadeIn {
                from { opacity: 0; transform: translateY(10px); }
                to { opacity: 1; transform: translateY(0); }
            }
            .animate-fadeIn {
                animation: fadeIn 0.7s ease-in-out;
            }
        </style>

        <title> {{title}} </title>
    </head>
    <body class="h-screen flex flex-col">
        <!-- Navbar -->
        <nav class="flex items-center justify-between w-full px-12 py-8 bg-white">
            <!-- Logo -->
            <img src="{% static 'Future OF Works.png' %}" alt="OwlphaDAO Future of Work Logo" class="w-32 h-4 object-contain"/>

            <!-- Navigation Links -->
            <a href="https://owlphadao.com/about" class="px-4 py-2 bg-yellow-700 text-white font-extrabold rounded-2xl cursor-pointer transition duration-400 hover:bg-yellow-800 text-sm md:text-base">
                About Us
            </a>
        </nav>
        
        <!-- Main Content -->
        <main class="flex-grow flex items-center justify-center px-4 pb-16"> 
            <div class="relative max-w-lg w-full bg-white p-8 rounded-2xl shadow-md text-center animate-fadeIn">
                
                <!-- Cancel Button -->
                <button onclick="window.location.href='{% url 'subscription_failed' subscription.pk %}'" class="absolute top-4 right-4 text-gray-400 hover:text-red-500 transition">
                    <!-- X icon -->
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-6 h-6">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>

                <h2 class="text-3xl font-extrabold mb-4 text-gray-800">Pay with Helio</h2>
                <p class="mb-6 text-gray-700 text-lg">
                    You selected the 
                    <span class="font-semibold text-gray-800">{{ subscription.plan_preference|title }}</span> 
                    plan at 
                    <span class="font-semibold text-yellow-700">${{ subscription.fee }}</span>/month.
                </p>
                
                <!-- Helio Checkout Widget -->
                <div id="helioCheckoutContainer" class="my-6 flex items-center justify-center"></div>
                <script type="module" crossorigin src="https://embed.hel.io/assets/index-v1.js"></script>

                <script>
                    document.addEventListener("DOMContentLoaded", () => {
                        window.helioCheckout(
                            document.getElementById("helioCheckoutContainer"),
                            {
                                paylinkId: "68ae6aa5a561997f2bc77057",
                                theme: { "themeMode": "dark" },
                                primaryColor: "#FE5300",
                                neutralColor: "#5A6578",
                                amount: "{{ subscription.fee }}", // dynamically from backend
                                display: "inline",
                                onSuccess: event => {
                                    console.log("Payment Success:", event);
                                    window.location.href = "{% url 'processing_payment' subscription.id %}";
                                },
                                onError: error => {
                                    console.log("Payment Error:", error);
                                    window.location.href = "{% url 'subscription_failed' subscription.id %}";
                                },
                                onPending: event => console.log("Payment Pending:", event),
                                onCancel: () => {
                                    console.log("Payment Cancelled");
                                    window.location.href = "{% url 'subscription_failed' subscription.id %}";
                                },
                                onStartPayment: () => console.log("Starting payment"),
                            }
                        );
                    });
                </script>

                <!-- Support text -->
                <p class="mt-6 text-xs text-gray-500">
                    Secure payments powered by Helio on Solana Blockchain.
                </p>
            </div>
        </main>
    </body>
</html>